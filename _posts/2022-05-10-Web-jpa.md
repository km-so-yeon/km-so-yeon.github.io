---
title: "[Spring] JPA ê°œë…, ì‚¬ìš©ë²•"
author: "ê¹€ì†Œì—°"
date: 2022-05-04 21:00:00 -0500
categories: [Web Application]
tags: [Spring, JPA]
---





## JPA ê°œë…

- Java Persistence API ì˜ ì•½ì



## ìŠ¤í”„ë§ì—ì„œ JPA ì‚¬ìš©í•˜ê¸°

#### JPA ê°œë°œ í™˜ê²½ êµ¬ì„±

1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì •

MAVEN í”„ë¡œì íŠ¸ : `pom.xml` ì— ì˜ì¡´ì„± ì¶”ê°€

```xml
 <!-- H2 database -->
 <dependency>
     <groupId>com.h2database</groupId>
     <artifactId>h2</artifactId>
     <scope>runtime</scope>
 </dependency>
    
 <!-- ìŠ¤í”„ë§ë¶€íŠ¸ìš© Spring Data JPA ì¶”ìƒí™” ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
 <dependency>
     <groupId>org.springframework.boot</groupId>
     <artifactId>spring-boot-starter-data-jpa</artifactId>
 </dependency>
   
 <!-- Lombok ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
 <dependency>
     <groupId>org.projectlombok</groupId>
     <artifactId>lombok</artifactId>
     <version>1.18.10</version>
     <scope>provided</scope>
 </dependency>
```

- h2
  - ì¸ë©”ëª¨ë¦¬ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤
  - ë³„ë„ì˜ ì„¤ì¹˜ì—†ì´ í”„ë¡œì íŠ¸ ì˜ì¡´ì„±ë§Œìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.
  - ë©”ëª¨ë¦¬ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•  ë•Œë§ˆë‹¤ ì´ˆê¸°í™”ëœë‹¤.
- spring-boot-starter-data-jpa
  - ìŠ¤í”„ë§ ë¶€íŠ¸ìš© Spring Data JPA ì¶”ìƒí™” ë¼ì´ë¸ŒëŸ¬ë¦¬
  - ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ì— ë§ì¶° ìë™ìœ¼ë¡œ JPA ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì˜ ë²„ì „ì„ ê´€ë¦¬í•´ì¤€ë‹¤.
- lombok
  - ë°˜ë³µë˜ëŠ” getter, setter, tostring ë“±ì˜ ë©”ì„œë“œ ì‘ì„±ì½”ë“œë¥¼ ì¤„ì—¬ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬



Gradle í”„ë¡œì íŠ¸ :  `build.gradle`ì— ì˜ì¡´ì„± ì¶”ê°€

```
dependencies {
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('org.projectlombok:lombok')
    compile('org.springframework.boot:spring-boot-stater-data-jpa')
    compile('com.h2database:h2')
    testCompile('org.springframework.boot:spring-boot-starter-test')
}
```



2. í™˜ê²½ ì„¤ì •

`application.properties` ì— ì„¤ì •

```
spring.jpa.hibernate.ddl-auto=create
spring.jpa.generate-ddl=false
spring.jpa.show-sql=true

spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.username=sa
spring.datasource.password=1234
spring.datasource.driver-class-name=org.h2.Driver
```

- spring.jpa.hibernate.ddl-auto
  - ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì‹œ(ì‹¤í–‰ ì‹œ) JPAì˜ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì „ëµ
    - none : ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
    - create : ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸” ìƒì„±
    - create-drop : ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ í›„ í…Œì´ë¸” ìƒì„±, ì¢…ë£Œ ì‹œì ì— í…Œì´ë¸” ì‚­ì œ
    - update : ë³€ê²½ëœ ìŠ¤í‚¤ë§ˆ ì ìš©
    - validate : ì—”í‹°í‹°ì™€ í…Œì´ë¸” ì •ìƒ ë§¤í•‘ í™•ì¸
- spring.jpa.generate-ddl
  - trueë¡œ ì„¤ì • ì‹œ `@Entity`ê°€ ëª…ì‹œëœ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ì„œ DDLì„ ìƒì„±í•˜ê³  ì‹¤í–‰
- spring.jpa.show-sql
  - ì½˜ì†”ì°½ì— ì¶œë ¥ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ê°€ë…ì„± ì¢‹ê²Œ í¬ë§·íŒ…

- spring.datasource
  - h2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •



#### Data JPA ì‚¬ìš©

1. ì—”í‹°í‹° ì„¤ê³„

```java
@Entity
@Table(name="member")
@Getter @Setter
@ToString
public class Member {

    @Id
    @Column(name="member_id")
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    private String name;
    
    @Column(unique = true)
    private String email;
}
```

- @Entity
  - JPA ì—”í‹°í‹° í´ë˜ìŠ¤ë¼ëŠ” ê²ƒì„ ì•Œë ¤ì¤€ë‹¤.
  - Entity í´ë˜ìŠ¤ëŠ” ë°˜ë“œì‹œ ê¸°ë³¸í‚¤ë¥¼ ê°€ì ¸ì•¼ í•œë‹¤. (@Id ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©)
- @Column
  - í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘
  - ì†ì„±
    - name : í•„ë“œë¥¼ ë§¤í•‘í•  ì»¬ëŸ¼ì˜ ì´ë¦„ ì„¤ì •
    - unique : ìœ ë‹ˆíŠ¸ ì œì•½ ì¡°ê±´ ì„¤ì •
- @GeneratedValue
  - ê¸°ë³¸í‚¤ë¥¼ ìƒì„±í•˜ëŠ” ì „ëµ(ë°©ë²•)
    - GenerationType_AUTO(default) : JPA êµ¬í˜„ì²´ê°€ ìë™ìœ¼ë¡œ ìƒì„± ì „ëµ ê²°ì • (IDENTITY, SEQUENCE, TABLE ì¤‘ í•˜ë‚˜)
    - GenerationType.IDENTITY : ê¸°ë³¸í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„
    - GenerationType.SEQUENCE : ë°ì´í„°ë² ì´ìŠ¤ ì‹œí€€ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•œ ê¸°ë³¸í‚¤ ìƒì„± (@SequenceGeneratorë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí€€ìŠ¤ ë“±ë¡ í•„ìš”-ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ê°’ì„ ë°˜í™˜í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ê°ì²´)
    - GenerationType.TABLE : í‚¤ ìƒì„±ìš© í…Œì´ë¸” ì‚¬ìš© (@TableGenerator í•„ìš”)

2. Repository ì„¤ê³„

```java
public interface MemberRepository extends JpaRepository<Member, Long>{
}
```

- RepositoryëŠ” JPARepositoryë¥¼ ìƒì†ë°›ëŠ”ë‹¤.

  - JpaRepository<T, ID> : ì œë„¤ë¦­ì€ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ì—”í‹°í‹°ì™€ ì—”í‹°í‹°ì˜ ì‹ë³„ì íƒ€ì…ì„ ì…ë ¥í•œë‹¤.

- JPARepositoryëŠ” ê¸°ë³¸ì ì¸ CRUD ë° í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•œ ë©”ì†Œë“œê°€ ì •ì˜ë˜ì–´ ìˆë‹¤.

  | ë©”ì†Œë“œ                        | ì„¤ëª…                |
  | ----------------------------- | ------------------- |
  | \<S extends T> save(S entity) | ì—”í‹°í‹° ì €ì¥ ë° ìˆ˜ì • |
  | void delete(T entity)         | ì—”í‹°í‹° ì‚­ì œ         |
  | count()                       | ì—”í‹°í‹° ì´ ê°œìˆ˜ ë°˜í™˜ |
  | Iterable\<T> findAll()        | ëª¨ë“  ì—”í‹°í‹° ì¡°íšŒ    |

3. ë©”ì¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‘ì„±

```java

```





#### JPA ê¸°ëŠ¥

1. ì¿¼ë¦¬ ë©”ì†Œë“œ

- ìŠ¤í”„ë§ ë°ì´í„° JPAì—ì„œ ì œê³µí•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜

- ë¬¸ë²• ì˜ˆì‹œ : find + (ì—”í‹°í‹° ì´ë¦„) + By + ë³€ìˆ˜ì´ë¦„

  - ì—”í‹°í‹° ì´ë¦„ ìƒëµ ê°€ëŠ¥
  - í˜¸ì¶œ ì‹œ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì¡°ê±´ìœ¼ë¡œí•˜ëŠ” select ì¿¼ë¦¬ë¬¸ ì‹¤í–‰

- Repository ì¸í„°í˜ì´ìŠ¤ì—  ë©”ì†Œë“œë¥¼ ì¶”ê°€í•˜ë©´ ì›í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

  ```java
  public interface MemberRepository extends JpaRepository<Member, Long>{
      Member findByEmail(String email);
  }
  ```



2. @Query ì–´ë…¸í…Œì´ì…˜

- JPQL(Java Persistence Query Language) ë¼ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ í†µí•´ ë³µì¡í•œ ì¿¼ë¦¬ë„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

  - SQLê³¼ ë¬¸ë²•ì´ ìœ ì‚¬í•˜ê¸° ë•Œë¬¸ì— ì‰½ê²Œ ë°°ìš¸ ìˆ˜ ìˆë‹¤.
  - ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
  - í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬ì´ë‹¤.
  - SQLì„ ì¶”ìƒí™”í•´ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤. (ë°ì´í„°ë² ì´ìŠ¤ê°€ ë³€ê²½ë˜ì–´ë„ ì˜í–¥ë°›ì§€ ì•ŠëŠ”ë‹¤.)

  ```java
  public interface MemberRepository extends JpaRepository<Member, Long>{
      @Query("select m from Member m where m.email = :email")
      Member findByEmail(@Param("email") String email);
  }
  ```

- @Param ì–´ë…¸í…Œì´ì…˜ : íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ ê°’ì„ JPQLì— ë“¤ì–´ê°ˆ ë³€ìˆ˜ë¡œ ì§€ì •í•œë‹¤.

- nativeQuery ì†ì„± : ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ë˜ ì¿¼ë¦¬ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•´ì•¼í•  ë•Œ ì‚¬ìš©í•œë‹¤.

  - íŠ¹ì • DBì— ì¢…ì†ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë¯€ë¡œ DBì— ëŒ€í•´ ë…ë¦½ì ì´ë¼ëŠ” ì¥ì ì„ ìƒëŠ”ë‹¤.



3. @NamedQuery ì–´ë…¸í…Œì´ì…˜

- ì—”í‹°í‹°

  ```java
  @Entity
  @Table(name="member")
  
  @NamedQuery(
  	name = "member.findByEmail"
  	query = "select m from Member m where m.email = :email"
  )
  
  @Getter @Setter
  @ToString
  public class Member {
  
      @Id
      @Column(name="member_id")
      @GeneratedValue(strategy = GenerationType.AUTO)
      private Long id;
  
      private String name;
      
      @Column(unique = true)
      private String email;
  }
  ```

- Repository

  ```java
  public interface MemberRepository extends JpaRepository<Member, Long>{
      Member findByEmail(@Param("email") String email);
  }
  ```



4. Querydsl



### ì¶œì²˜ğŸ“


- [https://parkhyeokjin.github.io](https://parkhyeokjin.github.io/jpa/2019/11/08/JPA-chap11.html)
- [https://velog.io/@swchoi0329](https://velog.io/@swchoi0329/Spring-Boot%EC%97%90%EC%84%9C-JPA-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0)
- ë°±ê²¬ë¶ˆì—¬ì¼íƒ€ ìŠ¤í”„ë§ë¶€í„° ì‡¼í•‘ëª°í”„ë¡œì íŠ¸
